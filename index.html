<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Message Preview ‚Äî AI (Study)</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0W5GKQVJ30"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0W5GKQVJ30');
</script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --card-radius:0px;
    --shadow:0 6px 22px rgba(12,20,30,0.08);
    --gap:14px;
    --maxw:920px;
    
    /* Dark bg for all pages */
    --dark-bg: #1e1e21;

    /* Urgency (human) */
    --dark-card: #2f2f32;
    --dark-text: #f0f0f0;
    --dark-muted: #98989a;
    --dark-link: #4da6ff;
    --dark-tab-bg: #2f2f32;
    --dark-tab-border: #404043;
    --dark-report-red: #ff6666;

    /* FAMILIARITY (human, the discord theme one) */
    --discord-bg: #313338;
    --discord-input: #383a40;
    --discord-text-main: #dbdee1;
    --discord-text-header: #f2f3f5;
    --discord-text-muted: #949ba4;
    --discord-link: #00a8fc;
    
    /* AUTHORITY (human, outlook theme) */
    --outlook-bg: #ffffff;
    --outlook-text: #242424;
    --outlook-header: #5c5c5c;
    --outlook-link: #005a9e; /* Specific Outlook Blue */
    --outlook-border: #eaeaea;
    --outlook-avatar-bg: #d2d2d2;
    
    /* FEAR (human, help center theme) */
    --help-bg: #f0f2f5; /* Light grey background */
    --help-card: #ffffff; /* White card */
    --help-border: #dddfe2; /* Subtle border */
    --help-text-main: #1c1e21; /* Dark text */
    --help-text-muted: #606770; /* Muted grey text */
    --help-link: #1877f2; /* Facebook blue */
    --help-tool-bg: #e4e6eb; /* Tool/button background */

    /* CURIOSITY (human, gambling theme, WHAT RAINBET?) */
    --gambling-bg-dark: #101827;
    --gambling-bg-light: #1c2a46;
    --gambling-gradient: linear-gradient(145deg, var(--gambling-bg-light) 0%, #0d121c 100%);
    --gambling-text: #ffffff;
    --gambling-accent: #00e0ff;
    --gambling-link: #3498db;
    --gambling-modal-bg: rgba(28, 42, 70, 0.95); /* Semi-transparent background */
    --gambling-modal-border: #00e0ff;
  }

  body { font-family: "Segoe UI", "Inter", system-ui, -apple-system, sans-serif; background:var(--dark-bg); margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:28px; color:#0b2545; }
  .wrap { width:100%; max-width:var(--maxw); display:grid; grid-template-columns:1fr; gap:20px; }
  
  /* Utilities */
  .card { background:white; border-radius:var(--card-radius); box-shadow:var(--shadow); padding:20px; box-sizing:border-box; }
  .cta { display:inline-block; padding:10px 14px; border-radius:10px; background:#007bff; color:white; text-decoration:none; font-weight:700; box-shadow:0 3px 10px rgba(0,123,255,0.12); cursor:pointer; }
  .cta:active { transform:translateY(1px); }
  .link-text { color:#0062cc; text-decoration:underline; cursor:pointer; font-weight:600; margin-left:10px; display:inline-block; }

  /* --- URGENCY STYLES --- */
  .dark-card { background:var(--dark-card); box-shadow:none; color:var(--dark-text); padding:0; border-radius: 0; }
  .dark-title { font-size:24px; font-weight:700; margin:0 0 20px 0; padding: 24px 24px 0 24px; color:var(--dark-text); }
  .dark-tabs-container { background:var(--dark-tab-bg); border-bottom:1px solid var(--dark-tab-border); display:flex; padding:0 24px; width: 100%; box-sizing: border-box; }
  .dark-tab { padding:14px 20px; font-weight:600; cursor:pointer; color:var(--dark-muted); border-bottom:3px solid transparent; margin-right: 12px; }
  .dark-tab.active { color:var(--dark-text); border-bottom-color:var(--dark-link); }
  .dark-inbox-wrap { padding: 24px; }
  .dark-inbox-header { display:flex; align-items:center; gap:8px; margin-bottom: 24px; padding-bottom: 8px; border-bottom: 1px solid var(--dark-tab-border); }
  .dark-archive-btn { color:var(--dark-muted); padding:0; border:none; background:transparent; cursor:pointer; font-size: 14px; }
  .dark-message-body { padding-top: 12px; }
  .dark-msg-line { margin:10px 0; }
  .dark-msg-top { display:flex; gap:10px; align-items:center; margin-bottom:16px; }
  .dark-avatar-wrap { width:40px; height:40px; position: relative; }
  .dark-avatar-wrap img { width:100%; height:100%; object-fit:cover; border-radius: 50%; z-index: 2; position: relative; }
  .dark-avatar-wrap::before { content: ''; position: absolute; top: -4px; left: -4px; width: 48px; height: 48px; border-radius: 50%; background: white; z-index: 1; }
  .dark-meta { font-size:13px; color:var(--dark-muted); }
  .dark-msg-title { font-size:18px; font-weight:700; color:var(--dark-text); margin:0 0 4px 0; }
  .dark-main-text { font-size:15px; color:var(--dark-text); line-height:1.5; }
  .dark-link-text { color:var(--dark-link); font-weight:600; cursor:pointer; display:inline-block; margin-top:8px; }
  .dark-report-abuse { color:var(--dark-report-red); font-size:14px; cursor:pointer; }

  /* FAMILIARITY (styles, discord theme, human)  */
  .discord-card { background-color: var(--discord-bg); color: var(--discord-text-main); padding: 16px; font-family: 'gg sans', 'Inter', sans-serif; border-radius: 4px; }
  .discord-header-area { padding: 16px 16px 24px 16px; margin-bottom: 16px; }
  .discord-big-avatar { width: 80px; height: 80px; border-radius: 50%; margin-bottom: 12px; background-color: var(--discord-input); }
  .discord-display-name { font-size: 28px; font-weight: 700; color: var(--discord-text-header); margin: 0; line-height: 1.2; }
  .discord-username { font-size: 20px; font-weight: 500; color: var(--discord-text-header); margin: 0 0 16px 0; }
  .discord-intro-text { color: var(--discord-text-muted); font-size: 14px; line-height: 1.4; }
  .discord-intro-text strong { color: var(--discord-text-header); font-weight: 600; }
  .discord-message-row { display: flex; gap: 16px; padding: 2px 16px; margin-top: 16px; }
  .discord-message-row:hover { background-color: rgba(2, 2, 2, 0.03); }
  .discord-pfp { width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0; cursor: pointer; }
  .discord-content { flex: 1; }
  .discord-name-line { display: flex; align-items: baseline; gap: 8px; margin-bottom: 4px; }
  .discord-sender { color: var(--discord-text-header); font-weight: 600; font-size: 16px; cursor: pointer; }
  .discord-sender:hover { text-decoration: underline; }
  .discord-timestamp { color: var(--discord-text-muted); font-size: 0.75rem; font-weight: 500; }
  .discord-body { font-size: 16px; line-height: 1.375rem; color: var(--discord-text-main); white-space: pre-wrap; }
  .discord-link { color: var(--discord-link); cursor: pointer; text-decoration: none; }
  .discord-link:hover { text-decoration: underline; }
  .discord-input-container { margin-top: 24px; padding: 0 16px; }
  .discord-input-bar { background-color: var(--discord-input); border-radius: 8px; display: flex; align-items: center; padding: 10px 16px; color: var(--discord-text-muted); font-size: 15px; }
  .discord-plus-icon { width: 24px; height: 24px; background: #b5bac1; color: var(--discord-input); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 18px; margin-right: 16px; cursor: pointer; }
  .discord-input-text { flex: 1; cursor: text; }
  .discord-icons { display: flex; gap: 12px; font-size: 20px; filter: grayscale(1); opacity: 0.7; }

  /* AUTHORITY (human, outlook theme) */
  .outlook-card {
    background: var(--outlook-bg);
    padding: 0; /* Header and body handled inside */
    font-family: "Segoe UI", sans-serif;
    color: var(--outlook-text);
  }
  .outlook-header {
    padding: 16px 24px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }
  .outlook-sender-info {
    display: flex;
    gap: 12px;
    align-items: center;
  }
  .outlook-avatar-circle {
    width: 48px;
    height: 48px;
    background-color: var(--outlook-avatar-bg);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #555;
    font-weight: 600;
    font-size: 18px;
  }
  .outlook-sender-text {
    display: flex;
    flex-direction: column;
  }
  .outlook-name {
    font-size: 16px;
    font-weight: 600;
    color: #242424;
  }
  .outlook-to {
    font-size: 13px;
    color: #666;
  }
  .outlook-actions-area {
    text-align: right;
  }
  .outlook-action-icons {
    display: flex;
    gap: 16px;
    justify-content: flex-end;
    margin-bottom: 4px;
    color: #005a9e; /* Action color */
    font-size: 14px;
    font-weight: 500;
  }
  .outlook-icon-item {
    display: flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
  }
  .outlook-date {
    font-size: 12px;
    color: #666;
  }
  
  /* The "Scrollable" Document Body */
  .outlook-scroll-container {
    max-height: 400px; /* Limits height to force scroll if content is long */
    overflow-y: auto;
    padding: 0 24px 24px 24px;
    border-top: 1px solid transparent; /* spacing fix */
  }
  
  .outlook-body-text {
    font-size: 14px;
    line-height: 1.6;
    margin-top: 16px;
    color: #242424;
  }
  .outlook-link {
    color: var(--outlook-link);
    text-decoration: underline;
    font-weight: 600;
    cursor: pointer;
  }
  .outlook-signature-stack {
    margin-top: 24px;
    font-size: 14px;
    line-height: 1.4;
    color: #242424;
  }
  .outlook-canvas-logo {
    display: block;
    margin: 32px auto;
    max-width: 140px;
  }
  .outlook-footer-links {
    text-align: center;
    font-size: 12px;
    color: var(--outlook-link);
    margin-bottom: 24px;
  }
  .outlook-footer-links span {
    text-decoration: underline;
    cursor: pointer;
    margin: 0 4px;
  }
  .outlook-disclaimer {
    font-size: 11px;
    color: #777;
    border-top: 1px solid #eaeaea;
    padding-top: 12px;
    line-height: 1.4;
  }
  .outlook-bottom-btns {
    padding: 16px 24px;
    border-top: 1px solid #eaeaea;
    display: flex;
    gap: 12px;
  }
  .outlook-chip {
    border: 1px solid #d1d1d1;
    border-radius: 4px;
    padding: 6px 16px;
    font-size: 14px;
    color: #242424;
    background: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .outlook-chip:hover {
    background: #f5f5f5;
  }

  /* --- FEAR (HELP CENTER/TOOL ROOM) STYLES --- */
  .help-card {
      background-color: var(--help-bg);
      padding: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      color: var(--help-text-main);
      border-radius: 8px;
      overflow: hidden;
  }
  .help-header {
      background-color: var(--help-card);
      padding: 16px 24px;
      border-bottom: 1px solid var(--help-border);
      font-size: 20px;
      font-weight: 700;
      color: var(--help-link);
  }
  .help-content-area {
      padding: 24px;
  }
  .help-warning-box {
      background-color: #f7f3e8; /* Soft warning yellow */
      border: 1px solid #f0e3c5;
      border-left: 5px solid #ffba00;
      padding: 16px;
      border-radius: 4px;
      margin-bottom: 20px;
  }
  .help-warning-title {
      font-weight: 600;
      color: #b27a00;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
  }
  .help-body-text {
      font-size: 15px;
      line-height: 1.5;
      color: var(--help-text-main);
  }
  .help-tool-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background-color: var(--help-tool-bg);
      padding: 10px 16px;
      border-radius: 6px;
      text-decoration: none;
      color: var(--help-text-main);
      font-weight: 600;
      margin-top: 20px;
      transition: background-color 0.1s;
  }
  .help-tool-link:hover {
      background-color: #d8dade;
  }
  .help-footer-text {
      font-size: 12px;
      color: var(--help-text-muted);
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid var(--help-border);
  }

  /* --- CURIOSITY (GAMBLING) STYLES --- */
  .gambling-card {
      background: var(--gambling-gradient);
      color: var(--gambling-text);
      padding: 0;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      position: relative;
      overflow: hidden;
      font-family: 'Inter', sans-serif;
  }
  /* Blurred background elements */
  .gambling-background-blur {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      filter: blur(8px);
      opacity: 0.4;
      z-index: 1;
      pointer-events: none;
  }
  .gambling-background-blur::before {
      content: 'üí∞üíéüé∞‚ú®'; /* Gambling elements */
      position: absolute;
      top: 10%;
      left: 5%;
      font-size: 150px;
      transform: rotate(-15deg);
  }
  .gambling-background-blur::after {
      content: 'üí∏üëëüîî7Ô∏è‚É£';
      position: absolute;
      bottom: 15%;
      right: 10%;
      font-size: 180px;
      transform: rotate(20deg);
  }
  /* Modal container */
  .gambling-modal {
      position: relative; /* To be above the blur */
      z-index: 2;
      padding: 30px;
      text-align: center;
      background: var(--gambling-modal-bg);
      border: 2px solid var(--gambling-modal-border);
      border-radius: 10px;
      margin: 40px;
  }
  .gambling-title {
      font-size: 28px;
      font-weight: 800;
      color: var(--gambling-accent);
      margin: 0 0 10px 0;
      text-shadow: 0 0 10px rgba(0, 224, 255, 0.5);
  }
  .gambling-body {
      font-size: 16px;
      line-height: 1.5;
      margin-bottom: 20px;
  }
  .gambling-link-btn {
      display: inline-block;
      padding: 12px 25px;
      border-radius: 8px;
      background: var(--gambling-accent);
      color: #101827;
      text-decoration: none;
      font-weight: 700;
      font-size: 16px;
      box-shadow: 0 4px 15px rgba(0, 224, 255, 0.4);
      transition: transform 0.1s;
  }
  .gambling-link-btn:active {
      transform: scale(0.98);
  }

  /* Legacy Styles */
  .title { font-size:18px; font-weight:700; margin:0 0 8px 0; color:#0b2545; }
  .sub { color:#516074; font-size:14px; margin:8px 0; }
  .small { font-size:13px; color:#5f6b75; }
  .muted { color:#7e8b93; font-size:13px; }
  .oldmail { font-family: "Times New Roman", Times, serif; background:#fff; border-radius:6px; padding:18px; border:1px solid #ddd; }
  .dark-reward { background:linear-gradient(135deg,#5a2db3,#b26be6); color:white; padding:20px; border-radius:12px; text-align:center; }
  .ai-badge { background:#e8f0ff; padding:6px 8px; border-radius:999px; display:inline-block; font-weight:700; color:#0b66d1; }
  .hr { height:1px; background:#eef3f6; margin:12px 0; border-radius:2px; }
  .muted-sm { font-size:13px; color:#98a2ad; }
  .tiny { font-size:12px; color:#97a0a6; }
  @media (min-width:880px){ .wrap { grid-template-columns:1fr } }

 

  /* Mobile (<- 480px) */
  @media (max-width: 480px) {
  body {
    padding: 12px;
  }

  .wrap {
    gap: 14px;
  }

  .card {
    padding: 16px;
  }

  .title {
    font-size: 16px;
  }

  .sub, .bubble, .docbox, .warning, .meta {
    font-size: 13px;
  }

  .cta {
    padding: 10px 14px;
    font-size: 14px;
  }

  /* Chat bubble adjustments */
  .chat .bubble {
    max-width: 100%;
  }
}

/* Tablets (481px - 768px) */
@media (max-width: 768px) {
  body {
    padding: 18px;
  }

  .card {
    padding: 20px;
  }

  .title {
    font-size: 17px;
  }
}

/* Large screens (>1100px) */
@media (min-width: 1100px) {
  .wrap {
    max-width: 760px; /* centered */
  }
}

</style>
</head>
<body>
  <div class="wrap" id="wrap">
  </div>

<script>
/* AI ONLY SYSTEM */

/* Shared constants  */
const FORM_LINK = "https://forms.office.com/Pages/ResponsePage.aspx?id=3F6kgO7V4EaddTfEe-m3zK4qozDLuUJCmdm-8GlwI-1UODBBNks0NlFBTUIxMDFWM0dSVVExMFZPTS4u";

/* ---------- AI POOL (kept same / final) ---------- */
const aiMessages = [
  { id: "AI_CURIO_01", type: "curiosity", title: "You've Been Selected ‚Äî Quick Preview", body: `Hi! You‚Äôve been selected to try an experimental preview. It‚Äôs quick, completely safe, and requires no personal information. Click the preview link to view.`, link: FORM_LINK, extraLinkText: "Open preview" },
  { id: "AI_FEAR_02", type: "fear", title: "Account Under Review ‚Äî Immediate Action Required", body: `Important Notice: A violation of our updated Terms & Conditions has been detected. Your account will be permanently removed within 24 hours unless you verify your identity.`, link: FORM_LINK, extraLinkText: "Verify account" },
  { id: "AI_URG_03", type: "urgency", title: "Reward Verification Required", body: `Your profile has been flagged for immediate reward processing. You have been identified for a 500 Robux reward ‚Äî confirm within 24 hours to avoid losing it.`, link: FORM_LINK, extraLinkText: "Claim reward" },
  { id: "AI_FAM_04", type: "familiarity", title: "Help ‚Äî Locked Out", body: `Hey! üò© I‚Äôm locked out of my account. Can you submit a short report for me at the link below? I‚Äôd really appreciate it!`, link: FORM_LINK, extraLinkText: "Submit report" },
  { id: "AI_AUTH_05", type: "authority", title: "Registrar Request: Documents Needed", body: `Dear Student,\n\nAs part of the review of your application, please upload official academic records using the link below to complete your file.`, link: FORM_LINK, extraLinkText: "Upload documents" }
];

/* ---------- Utils ---------- */
function escapeHtml(s){
  return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");
}

function chooseOneMessage(){
  // Select one AI message randomly
  const pick = aiMessages[Math.floor(Math.random()*aiMessages.length)];
  return { source: 'ai', message: pick };
}

/* ---------- Render AI messages (unchanged) ---------- */
function renderAI(m){
  const now = new Date();
  const dateStr = now.toLocaleDateString(undefined, { year:'numeric', month:'2-digit', day:'2-digit' });
  const timeStr = now.toLocaleTimeString(undefined, { hour:'2-digit', minute:'2-digit' }).toUpperCase();
  
  switch(m.type){
    case "curiosity":
      return `
      <div class="card curiosity" role="article" aria-labelledby="t_${m.id}" style="background:linear-gradient(135deg,#7a5cff,#b07cff); color:white;">
        <div style="font-weight:800;font-size:18px">You‚Äôre selected!</div>
        <h3 id="t_${m.id}" class="title" style="color:white">${escapeHtml(m.title)}</h3>
        <p style="color:rgba(255,255,255,0.95)">${escapeHtml(m.body)}</p>
        <div style="margin-top:12px">
          <a id="ai_cta_${m.id}" class="cta" style="background:rgba(255,255,255,0.12); color:white;">View Preview</a>
          <span id="ai_linktxt_${m.id}" class="link-text">${escapeHtml(m.extraLinkText || 'Open link')}</span>
        </div>
      </div>`;
    case "fear":
      return `
      <div class="card fear" role="article" aria-labelledby="t_${m.id}">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="font-size:28px;line-height:1;color:#ffdfdf">‚ö†Ô∏è</div>
          <div style="flex:1">
            <h3 id="t_${m.id}" class="title" style="color:white">${escapeHtml(m.title)}</h3>
            <div class="warning">${escapeHtml(m.body)}</div>
            <div style="margin-top:12px">
              <a id="ai_cta_${m.id}" class="cta" style="background:#ff4545">Verify Account</a>
              <span id="ai_linktxt_${m.id}" class="link-text">${escapeHtml(m.extraLinkText || 'Verify link')}</span>
            </div>
          </div>
        </div>
      </div>`;
    case "urgency":
      return `
      <div class="card urgency" role="article" aria-labelledby="t_${m.id}">
        <div class="row">
          <div><div class="ai-badge">AI</div></div>
          <div style="flex:1">
            <h3 id="t_${m.id}" class="title">${escapeHtml(m.title)}</h3>
            <div class="sub">${escapeHtml(m.body)}</div>
            <div style="margin-top:8px">
              <a id="ai_cta_${m.id}" class="cta">Verify Now</a>
              <span id="ai_linktxt_${m.id}" class="link-text">${escapeHtml(m.extraLinkText || 'Verify link')}</span>
              <span class="small" style="margin-left:12px">Deadline: <span class="countdown-elem">24h</span></span>
            </div>
          </div>
        </div>
      </div>`;
    case "familiarity":
      return `
      <div class="card chat" role="article" aria-labelledby="t_${m.id}">
        <div style="display:flex;gap:12px;align-items:flex-start">
          <div style="width:56px;height:56px;border-radius:10px;background:#e1f0ff;display:flex;align-items:center;justify-content:center;font-weight:700;color:#0b66d1">AI</div>
          <div style="flex:1">
            <h3 id="t_${m.id}" class="title">${escapeHtml(m.title)}</h3>
            <div class="bubble">${escapeHtml(m.body)}</div>
            <div style="margin-top:12px">
              <a id="ai_cta_${m.id}" class="cta">Submit Report</a>
              <span id="ai_linktxt_${m.id}" class="link-text">${escapeHtml(m.extraLinkText || 'Submit (AI)')}</span>
            </div>
          </div>
        </div>
      </div>`;
    case "authority":
      return `
      <div class="card authority" role="article" aria-labelledby="t_${m.id}">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="office">Registrar's Office</div>
            <h3 id="t_${m.id}" class="title">${escapeHtml(m.title)}</h3>
          </div>
        </div>
        <div class="hr"></div>
        <div class="docbox">${escapeHtml(m.body)}</div>
        <div style="margin-top:14px">
          <a id="ai_cta_${m.id}" class="cta">Upload Documents</a>
          <span id="ai_linktxt_${m.id}" class="link-text">${escapeHtml(m.extraLinkText || 'Upload (AI)')}</span>
        </div>
      </div>`;
    default:
      return `<div class="card"><h3 class="title">${escapeHtml(m.title)}</h3><p>${escapeHtml(m.body)}</p><a id="ai_cta_${m.id}" class="cta">Open</a></div>`;
  }
}

/* ---------- Choose and render ---------- */
const chosenWrap = chooseOneMessage();
const source = chosenWrap.source;
const chosen = chosenWrap.message;

let html = '';
if (source === 'ai') html = renderAI(chosen); 
document.getElementById('wrap').innerHTML = html;

/* ---------- Analytics: page_view & impression ---------- */
function safeGtag(name, params){
  if (typeof gtag === 'function') gtag('event', name, params);
}
if (source === 'ai'){
  safeGtag('ai_page_view', { message_id: chosen.id, message_type: chosen.type });
  safeGtag('ai_message_impression', { message_id: chosen.id, message_type: chosen.type });
}

/* ---------- Click registration (one click per visitor per message) ---------- */
let clicked = false;
function registerClick(prefix, id){
  if (clicked) return;
  clicked = true;
  if (prefix === 'ai') safeGtag('ai_link_click', { message_id: id, message_type: chosen.type });
}

/* AI click handlers: two clickable elements (button + link text) */
if (source === 'ai') {
  const btn = document.getElementById(`ai_cta_${chosen.id}`);
  const extra = document.getElementById(`ai_linktxt_${chosen.id}`);
  if (btn) btn.addEventListener('click', (e) => { registerClick('ai', chosen.id); window.open(chosen.link, '_blank', 'noopener'); });
  if (extra) extra.addEventListener('click', (e) => { registerClick('ai', chosen.id); window.open(chosen.link, '_blank', 'noopener'); });
}

/* ---------- Scroll detection ---------- */
let scrollSent = false;
function maybeSendScroll(){
  if (scrollSent) return;
  const doc = document.documentElement;
  const winH = window.innerHeight || doc.clientHeight;
  const fullH = Math.max(doc.scrollHeight, doc.clientHeight);
  const scrolled = window.scrollY || window.pageYOffset;
  const percent = ((scrolled + winH) / fullH) * 100;
  const threshold = (fullH <= winH * 1.5) ? 90 : 50;
  if (percent >= threshold) {
    scrollSent = true;
    if (source === 'ai') safeGtag('ai_scroll', { message_id: chosen.id, message_type: chosen.type, scroll_percent: Math.round(percent) });
  }
}
window.addEventListener('scroll', maybeSendScroll);

/* ---------- Heartbeat & time_on_page ---------- */
let secondsOnPage = 0;
let heartbeatTimer = null;

function startHeartbeat(){
  // increment once per second and send heartbeat every 10 seconds
  heartbeatTimer = setInterval(() => {
    secondsOnPage++;
    if (secondsOnPage % 10 === 0) {
      if (source === 'ai') safeGtag('ai_heartbeat', { message_id: chosen.id, secs: secondsOnPage });
    }
  }, 1000);
}
startHeartbeat();

window.addEventListener('pagehide', () => {
  if (heartbeatTimer) clearInterval(heartbeatTimer);
  if (source === 'ai') safeGtag('ai_time_spent_on_page', { message_id: chosen.id, secs: secondsOnPage });
});

/* safety: also clear heartbeat on unload */
window.addEventListener('unload', () => { if (heartbeatTimer) clearInterval(heartbeatTimer); });

/* ---------- Small accessibility: make inbox tabs clickable purely visual (do nothing) ---------- */
document.addEventListener('click', (e) => {
  // clicks inside tabs are visual only; already handled for specific actionable elements above
});

</script>
</body>
</html>


